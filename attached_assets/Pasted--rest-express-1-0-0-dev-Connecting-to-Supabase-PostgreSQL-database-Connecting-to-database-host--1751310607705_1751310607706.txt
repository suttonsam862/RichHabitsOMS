
> rest-express@1.0.0 dev
Connecting to Supabase PostgreSQL database...
Connecting to database host: db.ctznfijidykgjhzpuyej.supabase.co
Connecting to Supabase PostgreSQL database...
Connecting to database host: ctznfijidykgjhzpuyej.supabase.co
Initializing Supabase client with optimized settings...
Supabase client initialized with connection pooling
Using enhanced memory session store

ğŸš€ === THREADCRAFT APPLICATION STARTUP ===
ğŸ“… Startup Time: 2025-06-30T19:04:14.639Z
ğŸŒ Environment: development
ğŸ”§ Node Version: v20.18.1
ğŸ’» Platform: linux

ğŸ” ENVIRONMENT VARIABLES CHECK:
   âœ… SUPABASE_URL: Set
   âœ… SUPABASE_ANON_KEY: Set
   âœ… DATABASE_URL: Set
   âœ… SUPABASE_SERVICE_KEY: Set
   âœ… SESSION_SECRET: Set
   âœ… SENDGRID_API_KEY: Set

ğŸ—„ï¸ CHECKING DATABASE INITIALIZATION...

ğŸ”Œ === DATABASE CONNECTION TEST STARTING ===
ğŸŒ Environment: development
ğŸ“ Supabase URL: Set
ğŸ”‘ Anon Key: Set
ğŸ—„ï¸ Database URL: Set

ğŸ”„ Testing Supabase connection (attempt 1/3)...
â° Timestamp: 2025-06-30T19:04:14.640Z
âš¡ Query execution time: 282ms

âœ… SUPABASE CONNECTION SUCCESSFUL
   ğŸ“Š Query result: [{"count":1}]
   âš¡ Response time: 282ms
   ğŸ¯ Connection quality: Good
âœ… Supabase connection verified successfully
7:04:14 PM [express] serving on port 5000

ğŸ”Œ === DATABASE CONNECTION TEST STARTING ===
ğŸŒ Environment: development
ğŸ“ Supabase URL: Set
ğŸ”‘ Anon Key: Set
ğŸ—„ï¸ Database URL: Set

ğŸ”„ Testing Supabase connection (attempt 1/3)...
â° Timestamp: 2025-06-30T19:04:22.665Z
âš¡ Query execution time: 210ms

âœ… SUPABASE CONNECTION SUCCESSFUL
   ğŸ“Š Query result: [{"count":1}]
   âš¡ Response time: 210ms
   ğŸ¯ Connection quality: Good
7:04:22 PM [express] GET /api/health 200 in 213ms :: {"status":"ok","timestamp":"2025-06-30T19:04:22â€¦

ğŸ”Œ === DATABASE CONNECTION TEST STARTING ===
ğŸŒ Environment: development
ğŸ“ Supabase URL: Set
ğŸ”‘ Anon Key: Set
ğŸ—„ï¸ Database URL: Set

ğŸ”„ Testing Supabase connection (attempt 1/3)...
â° Timestamp: 2025-06-30T19:04:22.911Z
âš¡ Query execution time: 76ms

âœ… SUPABASE CONNECTION SUCCESSFUL
   ğŸ“Š Query result: [{"count":1}]
   âš¡ Response time: 76ms
   ğŸ¯ Connection quality: Excellent
7:04:22 PM [express] GET /api/ready 200 in 77ms :: {"status":"ready"}
7:04:23 PM [express] GET /api/auth/me 401 in 1ms :: {"success":false,"message":"Not authenticated"}
7:04:23 PM [express] POST /api/auth/login 400 in 3ms :: {"success":false,"message":"Invalid request â€¦
=== Authentication Debug ===
Headers: Missing
Session: No session method
No token found, proceeding unauthenticated
7:04:23 PM [express] GET /api/catalog-options/categories 401 in 1ms :: {"success":false,"message":"Aâ€¦
=== Authentication Debug ===
Headers: Missing
Session: No session method
No token found, proceeding unauthenticated
7:04:23 PM [express] GET /api/catalog-options/sports 401 in 1ms :: {"success":false,"message":"Autheâ€¦
=== Authentication Debug ===
Headers: Missing
Session: Present
No token found
7:04:23 PM [express] GET /api/catalog 401 in 1ms :: {"success":false,"message":"Authentication requiâ€¦
=== Authentication Debug ===
Headers: Missing
Session: Present
No token found
7:04:23 PM [express] GET /api/customers 401 in 1ms :: {"success":false,"message":"Authentication reqâ€¦
=== Authentication Debug ===
Headers: Missing
Session: Present
No token found
7:04:23 PM [express] GET /api/users 401 in 0ms :: {"success":false,"message":"Authentication requireâ€¦

ğŸ”Œ === DATABASE CONNECTION TEST STARTING ===
ğŸŒ Environment: development
ğŸ“ Supabase URL: Set
ğŸ”‘ Anon Key: Set
ğŸ—„ï¸ Database URL: Set

ğŸ”„ Testing Supabase connection (attempt 1/3)...
â° Timestamp: 2025-06-30T19:04:23.295Z
âš¡ Query execution time: 79ms

âœ… SUPABASE CONNECTION SUCCESSFUL
   ğŸ“Š Query result: [{"count":1}]
   âš¡ Response time: 79ms
   ğŸ¯ Connection quality: Excellent
7:04:23 PM [express] HEAD /api/health 200 in 80ms :: {"status":"ok","timestamp":"2025-06-30T19:04:23â€¦

ğŸ”Œ === DATABASE CONNECTION TEST STARTING ===
ğŸŒ Environment: development
ğŸ“ Supabase URL: Set
ğŸ”‘ Anon Key: Set
ğŸ—„ï¸ Database URL: Set

ğŸ”„ Testing Supabase connection (attempt 1/3)...
â° Timestamp: 2025-06-30T19:04:23.454Z
âš¡ Query execution time: 124ms

âœ… SUPABASE CONNECTION SUCCESSFUL
   ğŸ“Š Query result: [{"count":1}]
   âš¡ Response time: 124ms
   ğŸ¯ Connection quality: Good
7:04:23 PM [express] GET /api/health 200 in 125ms :: {"status":"ok","timestamp":"2025-06-30T19:04:23â€¦
Attempting login for user: samsutton@rich-habits.com
User authenticated successfully: 6b589bf2-be36-44ed-b143-7b871b2c507b
User metadata from Supabase Auth: {
  email_verified: true,
  firstName: 'Sam',
  is_super_admin: true,
  lastName: 'Sutton',
  role: 'admin'
}
User is a super admin, setting role to admin
Could not fetch user profile, creating minimal profile
Error creating user profile: {
  code: '42P17',
  details: null,
  hint: null,
  message: 'infinite recursion detected in policy for relation "user_profiles"'
}
7:07:28 PM [express] POST /api/auth/login 200 in 448ms :: {"success":true,"message":"Login successfuâ€¦
Using token from Authorization header
Using token from Authorization header
Using token from Authorization header
Session expired: k7G312oS...
7:07:29 PM [express] GET /api/catalog-options/categories 200 in 195ms :: {"success":true,"data":{"caâ€¦
Using token from Authorization header
Using token from Authorization header
=== Authentication Debug ===
Headers: Present
Session: Present
Using token from Authorization header
Session expired: k7G312oS...
=== Authentication Debug ===
Headers: Present
Session: Present
Using token from Authorization header
7:07:29 PM [express] GET /api/catalog-options/sports 200 in 167ms :: {"success":true,"data":{"sportsâ€¦
Token validated successfully for user: samsutton@rich-habits.com
User authenticated: samsutton@rich-habits.com Role: admin

ğŸ“ === CATALOG OPERATION: GET_CATALOG_ITEMS ===
ğŸ†” Request ID: catalog_1751310449830_2cstnjwrs
ğŸ“… Timestamp: 2025-06-30T19:07:29.830Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: GET /
=== END CATALOG OPERATION ===

Using token from Authorization header
Token validated successfully for user: samsutton@rich-habits.com
User authenticated: samsutton@rich-habits.com Role: admin
Fetching manufacturers only...
Session expired: k7G312oS...
7:07:29 PM [express] GET /api/users/manufacturers 200 in 199ms :: {"success":true,"data":{"manufactuâ€¦

ğŸ“ === CATALOG OPERATION: GET_CATALOG_ITEMS ===
ğŸ†” Request ID: catalog_1751310449900_yftmzwc2y
ğŸ“… Timestamp: 2025-06-30T19:07:29.900Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: GET /
ğŸ“Š Operation Data:
{
  "count": 3
}
=== END CATALOG OPERATION ===

Found 3 catalog items
Session expired: k7G312oS...
7:07:29 PM [express] GET /api/catalog 200 in 257ms :: [{"id":"3472a2e5-3de8-4171-890f-6564e6dab3b8",â€¦
Session expired: k7G312oS...
7:07:29 PM [express] GET /api/catalog-options/categories 200 in 251ms :: {"success":true,"data":{"caâ€¦
Session expired: k7G312oS...
7:07:30 PM [express] GET /api/catalog-options/sports 200 in 133ms :: {"success":true,"data":{"sportsâ€¦
Using token from Authorization header
=== Authentication Debug ===
Headers: Present
Session: Present
Using token from Authorization header
Token validated successfully for user: samsutton@rich-habits.com
User authenticated: samsutton@rich-habits.com Role: admin

ğŸ“ === CATALOG OPERATION: CHECK_SKU_EXISTS ===
ğŸ†” Request ID: catalog_1751310537187_5w8izria7
ğŸ“… Timestamp: 2025-06-30T19:08:57.187Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: GET /check-sku
ğŸ“Š Operation Data:
{
  "sku": "JER-MEN-536637-FHW"
}
=== END CATALOG OPERATION ===

Checking SKU existence: JER-MEN-536637-FHW

ğŸ“ === CATALOG OPERATION: CHECK_SKU_EXISTS ===
ğŸ†” Request ID: catalog_1751310537338_15grdlvfi
ğŸ“… Timestamp: 2025-06-30T19:08:57.338Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: GET /check-sku
ğŸ“Š Operation Data:
{
  "sku": "JER-MEN-536637-FHW",
  "exists": false
}
=== END CATALOG OPERATION ===

Session expired: k7G312oS...
7:08:57 PM [express] GET /api/catalog/check-sku 200 in 417ms :: {"success":true,"exists":false}
Using token from Authorization header
=== Authentication Debug ===
Headers: Present
Session: Present
Using token from Authorization header
Token validated successfully for user: samsutton@rich-habits.com
User authenticated: samsutton@rich-habits.com Role: admin

ğŸ“ === CATALOG OPERATION: CREATE_CATALOG_ITEM ===
ğŸ†” Request ID: catalog_1751310540255_85pdxsxab
ğŸ“… Timestamp: 2025-06-30T19:09:00.255Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: POST /
ğŸ“Š Operation Data:
{
  "requestBody": {
    "name": "Men's Singlet",
    "category": "Jersey",
    "sport": "Wrestling",
    "basePrice": 50,
    "unitCost": 17,
    "sku": "JER-MEN-536637-FHW",
    "status": "active",
    "imageUrl": "",
    "measurementChartUrl": "",
    "hasMeasurements": true,
    "measurementInstructions": "",
    "etaDays": "30",
    "preferredManufacturerId": "",
    "tags": [],
    "specifications": {}
  }
}
=== END CATALOG OPERATION ===

Creating new catalog item: {
  name: "Men's Singlet",
  sku: 'JER-MEN-536637-FHW',
  category: 'Jersey',
  sport: 'Wrestling'
}

ğŸ“ === CATALOG OPERATION: CREATE_CATALOG_ITEM ===
ğŸ†” Request ID: catalog_1751310540372_2xaabv6hs
ğŸ“… Timestamp: 2025-06-30T19:09:00.372Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: POST /
âŒ Operation Error:
   Type: Object
   Message: JSON object requested, multiple (or no) rows returned
   Code: PGRST116
   Details: The result contains 0 rows
=== END CATALOG OPERATION ===

Session expired: k7G312oS...
7:09:00 PM [express] POST /api/catalog 500 in 437ms :: {"success":false,"message":"Failed to check Sâ€¦
Using token from Authorization header
=== Authentication Debug ===
Headers: Present
Session: Present
Using token from Authorization header
Token validated successfully for user: samsutton@rich-habits.com
User authenticated: samsutton@rich-habits.com Role: admin

ğŸ“ === CATALOG OPERATION: CREATE_CATALOG_ITEM ===
ğŸ†” Request ID: catalog_1751310541703_ma2jy4gom
ğŸ“… Timestamp: 2025-06-30T19:09:01.703Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: POST /
ğŸ“Š Operation Data:
{
  "requestBody": {
    "name": "Men's Singlet",
    "category": "Jersey",
    "sport": "Wrestling",
    "basePrice": 50,
    "unitCost": 17,
    "sku": "JER-MEN-536637-FHW",
    "status": "active",
    "imageUrl": "",
    "measurementChartUrl": "",
    "hasMeasurements": true,
    "measurementInstructions": "",
    "etaDays": "30",
    "preferredManufacturerId": "",
    "tags": [],
    "specifications": {}
  }
}
=== END CATALOG OPERATION ===

Creating new catalog item: {
  name: "Men's Singlet",
  sku: 'JER-MEN-536637-FHW',
  category: 'Jersey',
  sport: 'Wrestling'
}

ğŸ“ === CATALOG OPERATION: CREATE_CATALOG_ITEM ===
ğŸ†” Request ID: catalog_1751310541779_4gcpwqnxa
ğŸ“… Timestamp: 2025-06-30T19:09:01.779Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: POST /
âŒ Operation Error:
   Type: Object
   Message: JSON object requested, multiple (or no) rows returned
   Code: PGRST116
   Details: The result contains 0 rows
=== END CATALOG OPERATION ===

Session expired: k7G312oS...
7:09:01 PM [express] POST /api/catalog 500 in 349ms :: {"success":false,"message":"Failed to check Sâ€¦
Using token from Authorization header
=== Authentication Debug ===
Headers: Present
Session: Present
Using token from Authorization header
Token validated successfully for user: samsutton@rich-habits.com
User authenticated: samsutton@rich-habits.com Role: admin

ğŸ“ === CATALOG OPERATION: CREATE_CATALOG_ITEM ===
ğŸ†” Request ID: catalog_1751310544136_a8d4em1l1
ğŸ“… Timestamp: 2025-06-30T19:09:04.136Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: POST /
ğŸ“Š Operation Data:
{
  "requestBody": {
    "name": "Men's Singlet",
    "category": "Jersey",
    "sport": "Wrestling",
    "basePrice": 50,
    "unitCost": 17,
    "sku": "JER-MEN-536637-FHW",
    "status": "active",
    "imageUrl": "",
    "measurementChartUrl": "",
    "hasMeasurements": true,
    "measurementInstructions": "",
    "etaDays": "30",
    "preferredManufacturerId": "",
    "tags": [],
    "specifications": {}
  }
}
=== END CATALOG OPERATION ===

Creating new catalog item: {
  name: "Men's Singlet",
  sku: 'JER-MEN-536637-FHW',
  category: 'Jersey',
  sport: 'Wrestling'
}

ğŸ“ === CATALOG OPERATION: CREATE_CATALOG_ITEM ===
ğŸ†” Request ID: catalog_1751310544329_zlxldd1j3
ğŸ“… Timestamp: 2025-06-30T19:09:04.329Z
ğŸ‘¤ User: samsutton@rich-habits.com (admin)
ğŸŒ Route: POST /
âŒ Operation Error:
   Type: Object
   Message: JSON object requested, multiple (or no) rows returned
   Code: PGRST116
   Details: The result contains 0 rows
=== END CATALOG OPERATION ===

Session expired: k7G312oS...
7:09:04 PM [express] POST /api/catalog 500 in 494ms :: {"success":false,"message":"Failed to check Sâ€¦
